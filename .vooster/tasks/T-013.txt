# AI 기반 FAQ 자동 생성 및 게시 기능

**Task ID:** T-013
**Status:** BACKLOG
**Importance:** SHOULD
**Complexity:** 8/10
**Urgency:** 5/10
**Dependencies:** T-002, T-003, T-004

## Description

### 설명
사용자 문의 트렌드를 반영하여 FAQ 콘텐츠를 최신 상태로 유지하기 위해, AI가 챗봇 대화 기록을 분석하여 새로운 FAQ 후보를 자동으로 생성하는 시스템을 구축합니다. 이 기능은 주기적으로 실행되며, 생성된 Q&A 초안은 관리자가 검토 후 최종 게시하여 콘텐츠의 질을 보장합니다.

### 구현 상세
1.  **데이터 소스 정의**: `T-004`에서 구축한 챗봇 대화 기록 테이블(`chat_logs`)을 분석 대상으로 합니다. 이 테이블에는 사용자 질문(`user_query`), AI 답변(`ai_response`), 세션 정보, 타임스탬프가 포함되어야 합니다.
2.  **Supabase Edge Function 생성**: `supabase functions new generate-faq-candidates` 명령으로 엣지 함수를 생성합니다. 이 함수는 Deno 런타임에서 실행됩니다.
3.  **분석 및 생성 로직 구현 (Edge Function)**:
    *   **데이터 조회**: 특정 기간(예: 지난 7일) 동안의 `chat_logs`를 조회합니다.
    *   **질문 클러스터링**: `text-embedding-3-large` 모델을 사용하여 모든 `user_query`를 벡터로 변환합니다. 변환된 벡터들을 `pgvector`의 `ivfflat` 또는 `hnsw` 인덱스를 사용하여 유사도 기반으로 클러스터링하여 비슷한 질문들을 그룹화합니다.
    *   **후보 추출**: 각 클러스터에서 가장 빈도가 높은 질문을 대표 질문으로 선정하고, 이미 `faq` 테이블에 존재하는 질문은 제외합니다.
    *   **답변 생성**: 선정된 대표 질문에 대해, OpenAI GPT-4o API를 호출하여 간결하고 정확한 답변 초안을 생성합니다.
    *   **DB 저장**: 생성된 질문과 답변 쌍을 `faq` 테이블에 `status = 'draft'` 상태로 저장합니다.
4.  **주기적 실행 스케줄링**: Supabase의 `pg_cron` 확장 기능을 사용하여 매주 특정 시간(예: 월요일 새벽 3시)에 위 엣지 함수를 호출하도록 스케줄을 등록합니다.
    ```sql
    SELECT cron.schedule('weekly-faq-generation', '0 3 * * 1', 'SELECT net.http_post(url:=''https://<project_ref>.supabase.co/functions/v1/generate-faq-candidates'', headers:=''{"Authorization": "Bearer <service_role_key>"}'')');
    ```
5.  **관리자 검토 UI**: `T-002`의 관리자 페이지에 'FAQ 초안 관리' 섹션을 추가합니다. 관리자는 이곳에서 `draft` 상태의 FAQ 목록을 확인하고, 내용을 편집하거나 `status`를 `published`로 변경하여 웹사이트에 게시할 수 있습니다.

### 테스트 전략
*   **단위 테스트**: 엣지 함수 내의 질문 클러스터링 로직과 OpenAI API 호출 부분을 모킹(mocking)하여 각 단위 기능이 정상 동작하는지 테스트합니다.
*   **통합 테스트**: 테스트용 대화 로그 데이터를 DB에 삽입한 후, 엣지 함수를 수동으로 트리거합니다. `faq` 테이블에 `draft` 상태의 새로운 데이터가 올바르게 생성되는지, 질문과 답변 내용이 적절한지 확인합니다.
*   **E2E 테스트**: 관리자가 관리자 페이지에 로그인하여 생성된 FAQ 초안을 'published' 상태로 변경했을 때, 사용자용 랜딩페이지의 FAQ 섹션에 해당 내용이 즉시 반영되는지 전체 흐름을 검증합니다.

---

**Created:** 2025-07-30T01:28:32.479Z
**Updated:** 2025-07-30T01:28:32.479Z
