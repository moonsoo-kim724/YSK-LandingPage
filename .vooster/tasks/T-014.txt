# 관리자용 데이터 시각화 대시보드 개발

**Task ID:** T-014
**Status:** BACKLOG
**Importance:** SHOULD
**Complexity:** 7/10
**Urgency:** 6/10
**Dependencies:** T-002, T-005, T-006

## Description

### 설명
병원 관계자 및 마케팅팀이 실시간으로 비즈니스 성과를 파악하고 데이터 기반 의사결정을 내릴 수 있도록, 핵심 지표(KPI)를 시각화한 관리자 전용 대시보드를 개발합니다. 대시보드는 리드 수, 예약 건수, 전환율 등의 데이터를 차트와 그래프로 제공하며, 역할 기반 접근 제어를 통해 인가된 사용자만 접근할 수 있습니다.

### 구현 상세
1.  **보호된 라우트 설정**: Next.js App Router의 미들웨어나 레이아웃을 사용하여 `/admin/dashboard` 경로에 접근 제어를 구현합니다. Supabase 클라이언트의 `getUser()`를 통해 사용자 세션을 확인하고, 특정 역할(예: `admin`)을 가진 사용자가 아닐 경우 로그인 페이지로 리디렉션합니다.
2.  **데이터 집계용 DB 함수 생성**: Supabase SQL 편집기에서 PostgreSQL 함수(RPC)를 생성하여 복잡한 데이터 집계 로직을 캡슐화합니다. 이 함수는 `leads`와 `reservations` 테이블을 조인하여 날짜 범위에 따른 일별/주별/월별 리드 수, 예약 수, 전환율 등을 계산하여 반환합니다.
    ```sql
    -- 예시: 일별 통계를 반환하는 RPC 함수
    CREATE OR REPLACE FUNCTION get_dashboard_analytics(start_date text, end_date text)
    RETURNS jsonb AS $$
    DECLARE
      result jsonb;
    BEGIN
      -- ... 리드, 예약 데이터를 집계하여 JSON 형태로 가공하는 로직 ...
      RETURN result;
    END;
    $$ LANGUAGE plpgsql;
    ```
3.  **대시보드 UI 개발**: `shadcn/ui`의 `Card`, `Table` 컴포넌트와 차트 라이브러리 `Tremor` 또는 `Recharts`를 사용하여 UI를 구성합니다.
    *   **KPI 카드**: 총 리드, 총 예약, 전체 전환율 등 핵심 지표를 표시합니다.
    *   **시계열 차트**: 시간 경과에 따른 리드 및 예약 수 추세를 보여주는 라인 또는 바 차트를 구현합니다.
    *   **데이터 테이블**: 상세 데이터를 표 형태로 제공합니다.
    *   **날짜 범위 필터**: `shadcn/ui`의 `DatePicker`를 사용하여 사용자가 조회 기간을 선택할 수 있게 합니다.
4.  **데이터 Fetching 및 상태 관리**: 클라이언트 컴포넌트에서 `@tanstack/react-query`를 사용하여 Supabase RPC 함수를 호출합니다. `useQuery` 훅을 통해 데이터를 가져오고, 캐싱, 로딩 및 에러 상태를 효율적으로 관리합니다. 날짜 필터가 변경되면 쿼리 키를 변경하여 데이터를 다시 가져오도록 구현합니다.

### 테스트 전략
*   **단위 테스트**: 차트 및 카드 UI 컴포넌트가 주어진 props 데이터에 따라 올바르게 렌더링되는지 Storybook 또는 Jest로 테스트합니다.
*   **통합 테스트**: Supabase SQL 클라이언트에서 RPC 함수를 직접 호출하여 예상된 집계 데이터를 정확하게 반환하는지 검증합니다. Next.js 페이지에서 RPC를 호출하여 반환된 데이터가 React Query 상태에 올바르게 반영되는지 확인합니다.
*   **E2E 테스트**: 관리자 계정으로 로그인하여 대시보드 페이지에 성공적으로 접근하는지 테스트합니다. 날짜 필터를 변경했을 때 차트와 KPI 데이터가 비동기적으로 업데이트되는지 검증합니다. 일반 사용자 계정이나 비로그인 상태에서 `/admin/dashboard` 접근 시 접근이 차단되고 로그인 페이지로 리디렉션되는지 확인합니다.

---

**Created:** 2025-07-30T01:28:32.479Z
**Updated:** 2025-07-30T01:28:32.479Z
